<!DOCTYPE html>
<html>
<head>
    <title>üéØ Master Prediction Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1600px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 48px; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); text-align: center; transition: transform 0.3s; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card h2 { font-size: 48px; color: #667eea; margin-bottom: 10px; }
        .stat-card p { color: #7f8c8d; font-size: 16px; }
        .main-content { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        .panel { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .panel h3 { color: #2c3e50; margin-bottom: 20px; font-size: 24px; }
        .btn-group { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
        .btn { padding: 15px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; }
        .btn-warning { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
        .btn-info { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
        .btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ecf0f1; }
        th { background: #34495e; color: white; font-weight: bold; }
        tr:hover { background: #f8f9fa; }
        .learned { background: #d4edda; }
        .pending { background: #fff3cd; }
        .badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .badge-success { background: #28a745; color: white; }
        .badge-warning { background: #ffc107; color: #000; }
        .badge-info { background: #17a2b8; color: white; }
        .prediction-box { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .prediction-box h4 { margin-bottom: 15px; }
        .numbers { display: flex; gap: 10px; flex-wrap: wrap; }
        .number { background: white; color: #667eea; padding: 15px 20px; border-radius: 10px; font-size: 24px; font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .chart { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 20px; }
        .output { background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 10px; font-family: 'Courier New', monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ MASTER PREDICTION SYSTEM</h1>
            <p style="font-size: 18px;">AI-Powered Multi-Module Learning Engine</p>
            <p>Last Updated: {{ last_updated }}</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h2>{{ stats.total }}</h2>
                <p>Total Predictions</p>
            </div>
            <div class="stat-card">
                <h2>{{ stats.learned }}</h2>
                <p>Learned</p>
            </div>
            <div class="stat-card">
                <h2>{{ stats.pending }}</h2>
                <p>Pending</p>
            </div>
            <div class="stat-card">
                <h2>{{ stats.avg_matches }}</h2>
                <p>Avg Matches</p>
            </div>
            <div class="stat-card">
                <h2>{{ stats.best_match }}</h2>
                <p>Best Match</p>
            </div>
            <div class="stat-card">
                <h2>{{ stats.total_matches }}</h2>
                <p>Total Matches</p>
            </div>
        </div>
        
        <div class="main-content">
            <div class="panel">
                <h3>üìä Prediction History</h3>
                
                {% if latest_prediction %}
                <div class="prediction-box">
                    <h4>üîÆ Latest Prediction for {{ latest_prediction.date }}</h4>
                    <div class="numbers">
                        {% for num in latest_prediction.predicted_numbers.split(',') %}
                        <div class="number">{{ num }}</div>
                        {% endfor %}
                    </div>
                    <p style="margin-top: 15px;">
                        Confidence: {{ latest_prediction.confidence_score }}% | 
                        Sources: {{ latest_prediction.pattern_source }}
                    </p>
                </div>
                {% endif %}
                
                <table>
                    <tr>
                        <th>Date</th>
                        <th>Predicted</th>
                        <th>Actual</th>
                        <th>Matches</th>
                        <th>Confidence</th>
                        <th>Sources</th>
                        <th>Status</th>
                    </tr>
                    {% for pred in predictions %}
                    <tr class="{% if pred.learned %}learned{% else %}pending{% endif %}">
                        <td>{{ pred.date }}</td>
                        <td><strong>{{ pred.predicted_numbers }}</strong></td>
                        <td>{{ pred.actual_numbers or '-' }}</td>
                        <td>{{ pred.match_count }}</td>
                        <td>{{ pred.confidence_score }}%</td>
                        <td>{{ pred.pattern_source }}</td>
                        <td>
                            {% if pred.learned %}
                            <span class="badge badge-success">‚úì Learned</span>
                            {% else %}
                            <span class="badge badge-warning">‚è≥ Pending</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
            
            <div>
                <div class="panel">
                    <h3>üéÆ Control Panel</h3>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="runPredict()">üîÆ Predict Tomorrow</button>
                        <button class="btn btn-success" onclick="showAddResult()">‚úÖ Add Result</button>
                        <button class="btn btn-warning" onclick="retrain()">üîÑ Retrain Model</button>
                        <button class="btn btn-info" onclick="viewStats()">üìä View Stats</button>
                    </div>
                    
                    <div id="output" class="output" style="display: none;"></div>
                </div>
                
                <div class="panel" style="margin-top: 20px;">
                    <h3>üìà Module Performance</h3>
                    <div class="chart">
                        {% for source, perf in module_performance.items() %}
                        <div style="margin-bottom: 15px;">
                            <strong>{{ source }}</strong>
                            <div style="background: #ecf0f1; height: 30px; border-radius: 5px; overflow: hidden; margin-top: 5px;">
                                <div style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: {{ perf }}%; display: flex; align-items: center; padding-left: 10px; color: white; font-weight: bold;">
                                    {{ perf }}%
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <div class="panel" style="margin-top: 20px;">
                    <h3>üí° Quick Guide</h3>
                    <ol style="line-height: 2;">
                        <li>Click "Predict Tomorrow" daily</li>
                        <li>Add results after draw</li>
                        <li>System learns automatically</li>
                        <li>Retrain after 10+ results</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function runPredict() {
            document.getElementById('output').style.display = 'block';
            document.getElementById('output').textContent = 'üîÑ Running all modules and generating prediction...';
            
            fetch('/run-master-predict', { method: 'POST' })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success') {
                        document.getElementById('output').textContent = data.output;
                        setTimeout(() => location.reload(), 2000);
                    } else {
                        document.getElementById('output').textContent = '‚ùå Error: ' + data.message;
                    }
                });
        }
        
        function showAddResult() {
            const date = prompt('Enter draw date (YYYY-MM-DD):');
            const numbers = prompt('Enter actual numbers (comma-separated):');
            if (date && numbers) {
                fetch('/add-master-result', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({date: date, numbers: numbers})
                })
                .then(r => r.json())
                .then(data => {
                    alert(data.message);
                    location.reload();
                });
            }
        }
        
        function retrain() {
            if (confirm('Retrain model with latest data?')) {
                document.getElementById('output').style.display = 'block';
                document.getElementById('output').textContent = 'üîÑ Retraining model...';
                
                fetch('/retrain-master-model', { method: 'POST' })
                    .then(r => r.json())
                    .then(data => {
                        document.getElementById('output').textContent = data.message;
                    });
            }
        }
        
        function viewStats() {
            fetch('/master-stats')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('output').style.display = 'block';
                    document.getElementById('output').textContent = data.stats;
                });
        }
    </script>
</body>
</html>
